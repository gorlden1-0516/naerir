<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>評鑑規則列表 - 國家教育研究院學術典藏系統</title>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/tailwind.min.css">
    <link rel="stylesheet" href="./css/main.min.css">
    <link rel="stylesheet" href="./css/style.min.css">
    <script src="./js/jquery.min.js"></script>
    <script src="./js/jquery-ui.min.js"></script>
    <script src="./js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="./css/style.css">
    <style>
        /* 編輯按鈕深藍色 */
        #rulesTableBody .btn-outline-primary { color: #002e6d; border-color: #002e6d; }
        #rulesTableBody .btn-outline-primary:hover { background-color: #002e6d; border-color: #002e6d; color: #fff; }
    </style>
</head>
<body id="top" class="page focus tw-min-h-screen">
    <header class="header-main">
        <nav class="navbar navbar-expand-lg navbar-light navbar-main py-lg-0">
            <div class="container-fluid flex-wrap">
                <a class="navbar-brand" href="#">
                    <img src="./images/logo.svg" alt="LOGO" class="d-none d-lg-flex flex-fill">
                    <span class="d-lg-none">國家教育研究院</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse flex-lg-wrap col-lg-12" id="navbarSupportedContent">
                    <div class="navbar-nav navbar-light navbar-dropdown navbar-primaryNav">
                        <div class="nav-item"><a class="nav-link" href="#">研究人員功能</a></div>
                        <div class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle active" href="#" data-bs-toggle="dropdown">系統管理</a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item active" href="admin_evaluation_rules_list.html">評鑑規則與預警設定</a>
                                <a class="dropdown-item" href="#">帳號權限管理</a>
                            </div>
                        </div>
                        <div class="nav-item"><a class="nav-link" href="#">帳號登入/登出</a></div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="pt-lg-3">
            <div class="lg:tw-space-y-4 container-fluid py-2">
                <div class="card card-body shadow-sm tw-border-0">
                    <div class="min_height-550">

                        <div class="row row-cols-lg-auto g-lg-4">
                            <div class="col-lg-12">
                                <h2 class="border-bottom tw-text-base sm:tw-text-2xl tw-font-bold overflow-hidden mb-4">
                                    評鑑規則與預警設定
                                </h2>

                                <ul class="nav nav-tabs mb-4">
                                    <li class="nav-item">
                                        <a class="nav-link active fw-bold" href="admin_evaluation_rules_list.html">1. 評鑑規則設定</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link text-secondary" href="admin_warning_settings.html">2. 預警通知設定</a>
                                    </li>
                                </ul>

                                <div class="mb-3 d-flex justify-content-end">
                                    <a class="btn btn-primary" href="admin_evaluation_rules.html">新增規則</a>
                                </div>

                                <div class="bg-light p-4 rounded mb-4">
                                    <div class="row g-3 align-items-end">
                                        <div class="col-md-6">
                                            <label for="ruleKeyword" class="form-label fw-bold">規則名稱查詢</label>
                                            <input type="text" class="form-control" id="ruleKeyword" placeholder="請輸入規則名稱">
                                        </div>
                                        <div class="col-md-2">
                                            <button class="btn btn-primary w-100" onclick="searchRules()">查詢</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="table-responsive">
                                    <table class="table table-striped table-hover align-middle border">
                                        <thead class="table-dark">
                                            <tr>
                                                <th scope="col" width="10%">編號</th>
                                                <th scope="col" width="35%">規則名稱</th>
                                                <th scope="col" width="20%" class="text-center">是否使用</th>
                                                <th scope="col" width="20%" class="text-center">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="rulesTableBody">
                                        </tbody>
                                    </table>
                                </div>

                                <div class="pagination-container" id="rulesPagination">
                                    <button class="page-btn" onclick="changeRulePage('first')" title="最前頁">&lt;&lt;</button>
                                    <button class="page-btn" onclick="changeRulePage('prev')" title="上一頁">&lt;</button>
                                    <span class="page-info" id="rulePageInfo">第 1 頁 / 共 1 頁</span>
                                    <button class="page-btn" onclick="changeRulePage('next')" title="下一頁">&gt;</button>
                                    <button class="page-btn" onclick="changeRulePage('last')" title="最末頁">&gt;&gt;</button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer py-3">
        <div class="container-fluid pt-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="small mb-0">國家教育研究院著作權聲明 Copyright © 2024 All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        var allRules = [];
        var year = 2025;
        var serial = 0;
        for (var i = 1; i <= 13; i++) {
            serial++;
            if (year === 2025 && serial > 10) { year = 2026; serial = 1; }
            var code = year + ('0' + serial).slice(-2);
            allRules.push({
                id: 14 - i,
                name: code + '評鑑與預警設定規則',
                inUse: false
            });
        }
        allRules.reverse();
        allRules[0].inUse = true;
        allRules.forEach(function(r, idx) { r.id = idx + 1; });

        var ruleCurrentPage = 1;
        var rulePageSize = 10;
        var filteredRules = allRules;

        function searchRules() {
            var kw = $('#ruleKeyword').val().toLowerCase();
            filteredRules = allRules.filter(function(item) {
                return item.name.toLowerCase().indexOf(kw) > -1;
            });
            ruleCurrentPage = 1;
            renderRulesTable();
        }

        function renderRulesTable() {
            var totalPages = Math.ceil(filteredRules.length / rulePageSize);
            if (totalPages === 0) totalPages = 1;
            if (ruleCurrentPage > totalPages) ruleCurrentPage = totalPages;

            var start = (ruleCurrentPage - 1) * rulePageSize;
            var end = start + rulePageSize;
            var pageData = filteredRules.slice(start, end);

            var html = '';
            if (pageData.length === 0) {
                html = '<tr><td colspan="4" class="text-center text-muted py-4">查無資料</td></tr>';
            } else {
                $.each(pageData, function(index, item) {
                    html += '<tr>';
                    html += '<td>' + item.id + '</td>';
                    html += '<td>' + item.name + '</td>';
                    html += '<td class="text-center">' + (item.inUse ? '是' : '否') + '</td>';
                    html += '<td class="text-center">';
                    html += '<a class="btn btn-sm btn-outline-primary me-1" href="admin_evaluation_rules.html?id=' + item.id + '">編輯</a>';
                    html += '</td>';
                    html += '</tr>';
                });
            }
            $('#rulesTableBody').html(html);

            $('#rulePageInfo').text('第 ' + ruleCurrentPage + ' 頁 / 共 ' + totalPages + ' 頁');

            $('#rulesPagination .page-btn').removeClass('disabled');
            if (ruleCurrentPage === 1) {
                $('#rulesPagination .page-btn[onclick*="first"]').addClass('disabled');
                $('#rulesPagination .page-btn[onclick*="prev"]').addClass('disabled');
            }
            if (ruleCurrentPage === totalPages) {
                $('#rulesPagination .page-btn[onclick*="next"]').addClass('disabled');
                $('#rulesPagination .page-btn[onclick*="last"]').addClass('disabled');
            }
        }

        function changeRulePage(action) {
            var totalPages = Math.ceil(filteredRules.length / rulePageSize);
            if (totalPages === 0) totalPages = 1;

            if (action === 'first') ruleCurrentPage = 1;
            else if (action === 'prev' && ruleCurrentPage > 1) ruleCurrentPage--;
            else if (action === 'next' && ruleCurrentPage < totalPages) ruleCurrentPage++;
            else if (action === 'last') ruleCurrentPage = totalPages;

            renderRulesTable();
        }

        $(document).ready(function() {
            renderRulesTable();
        });
    </script>
</body>
</html>
